<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/ReactJS-Practice-F88/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B√†i t·∫≠p 1.2: Todo List App</title>
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="../../assets/css/main.css" />
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;
      let uniqId = 0;

      const Header = () => {
        const [path, setPath] = useState("/");

        useEffect(() => {
          const isProduct =
            window.location.hostname !== "localhost" &&
            window.location.hostname !== "127.0.0.1";
          setPath(isProduct ? "/ReactJS-Practice-F88/" : "/");
        }, []);

        const ToggleTheme = () => {
          const [theme, setTheme] = useState(() => {
            const localTheme = localStorage.getItem("theme");
            return !localTheme ? "dark" : localTheme;
          });

          useEffect(() => {
            document.documentElement.className = theme;
          }, [theme]);

          const toggle = () => {
            const newTheme = theme === "dark" ? "light" : "dark";
            localStorage.setItem("theme", newTheme);
            setTheme(newTheme);
          };

          return (
            <button className="toggle-theme" onClick={toggle}>
              {theme === "dark" ? "üåô" : "‚òÄÔ∏è"}
            </button>
          );
        };

        return (
          <header id="header">
            <div className="header">
              <h1 className="slogan">Conquer ReactJS with F8 üöÄ </h1>
              <a className="gotoback" href={path}>
                Home
              </a>
              <ToggleTheme />
            </div>

            <p className="desc">
              D·∫•u ·∫•n kh√°m ph√° v√† th·ª±c h√†nh ReactJS c√πng F8
              <a href="https://fullstack.edu.vn/">{` - fullstack.edu.vn - `}</a>
              H·ªçc l·∫≠p tr√¨nh ƒë·ªÉ ƒëi l√†m!
            </p>
          </header>
        );
      };

      function TodoApp() {
        const [inputValue, setInputValue] = useState("");
        const [todos, setTodos] = useState([]);
        const [done, setDone] = useState({ finished: 0, unfinished: 0 });

        useEffect(() => {
          const fobs = JSON.parse(localStorage.getItem("todos")) || [];
          if (fobs.length) {
            uniqId = Math.max(...fobs.map((item) => item.id));
          }
          setTodos(fobs);
        }, []);

        useEffect(() => {
          localStorage.setItem("todos", JSON.stringify(todos));
          handleFinished();
        }, [todos]);

        const handleInputChange = (e) => {
          if (!e.target.value) return;
          setInputValue(e.target.value); // L·∫•y gi√° tr·ªã t·ª´ input
        };

        const handleSubmit = (e) => {
          e.preventDefault();
          document.querySelector("#todo-input").focus();
          if (!inputValue) return;
          if (inputValue.trim()) {
            setTodos([
              ...todos,
              { id: ++uniqId, text: inputValue, completed: false },
            ]);
            setInputValue(""); // Reset input sau khi th√™m
          }
        };

        const handleChecked = (e) => {
          const tasks = todos.map((item) => {
            if (item.id === Number(e.target.closest(".task-detail").id)) {
              item.completed = !item.completed;
            }
            return item;
          });
          handleFinished();
          setTodos([...tasks]);
        };

        const handleDelete = (e) => {
          const eleDelete = e.target.closest(".task-detail");
          const tasks = todos.filter((item) => {
            return item.id !== Number(eleDelete.id);
          });
          setTodos(tasks);
        };

        const handleFinished = () => {
          const jobs = todos.filter((item) => {
            return item.completed === true;
          });
          setDone({
            finished: jobs.length,
            unfinished: todos.length - jobs.length,
          });
        };

        return (
          <div className="container">
            <Header />
            <div className="exercise-content">
              <h2 className="exercise_1">B√†i t·∫≠p 1.2: Todo List App</h2>
              <a
                href="https://github.com/xuanphao19/ReactJS-Practice-F88/blob/main/public/exercises/exercises_1/todo.html"
                className="repositories">
                Repositories GitHub
              </a>
              <div className="wrapper todo-list">
                <ul className="list-task">
                  {todos.length > 0 ? (
                    todos.map((task) => {
                      return (
                        <li key={task.id} id={task.id} className="task-detail">
                          <input
                            className="task-ctrl"
                            type="checkbox"
                            name="checkbox"
                            checked={task.completed}
                            onChange={handleChecked}
                          />
                          <p className="task-name">{task.text}</p>
                          <button
                            onClick={handleDelete}
                            className="delete-task">
                            X√≥a
                          </button>
                        </li>
                      );
                    })
                  ) : (
                    <li className="vain">
                      Ch∆∞a c√≥ c√¥ng vi·ªác. Th√™m c√¥ng vi·ªác ƒë·∫ßu ti√™n
                    </li>
                  )}
                </ul>

                <div className="statistical">
                  <span className="total-work">T·ªïng: {todos.length}</span>
                  <span className="completed-work">
                    ƒê√£ l√†m: {done.finished}
                  </span>
                  <span className="incomplete-work">
                    Ch∆∞a l√†m: {done.unfinished}
                  </span>
                </div>
                <form onSubmit={handleSubmit}>
                  <input
                    id="todo-input"
                    value={inputValue}
                    onChange={handleInputChange}
                    placeholder="Nh·∫≠p c√¥ng vi·ªác m·ªõi..."
                  />
                  <button type="submit">Th√™m</button>
                </form>
              </div>
            </div>
          </div>
        );
      }
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<TodoApp />);
    </script>
  </body>
</html>
